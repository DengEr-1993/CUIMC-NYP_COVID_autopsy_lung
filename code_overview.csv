Folder,File name,Title,Input,Output,Figures/tables generated
B_cell_analysis,B_cell_analysis/B_cell_UMAP.R,UMAPs and dot plots of B cells,Integrated Seurat object with cell type assignment,-,"Extended Data Figure 6A,B,C"
B_cell_analysis,B_cell_analysis/IG_combination_count_from_B_cells.R,Counting number of IG combinations in B cells,B cell Seurat object with cell type assignment,table of all IG combinations found in all B cells,"Figure 2H-I, Extended Data Figure 6 D, H-I, Extended Data Table 6"
B_cell_analysis,B_cell_analysis/IG_combination_plots.R,Print out heatmaps of IG combination usage in B cells,"table of all IG combinations found in all B cells, from IG_combinations_count_from_B_cells.R",,"Fig 2F-G, Extended Data Figure B-cells E-G"
CellPhoneDB_ligand_receptor_analysis,CellPhoneDB_ligand_receptor_analysis/CPDB_interactionCountsCombined.R,Cell-cell interaction count analysis and interactome figure generation,CellPhoneDB results for each individual sample,"COVID ligand-receptor interactome, control ligand-receptor interactome","Fig 4H,I;  Extended Data Figure 13a"
CellPhoneDB_ligand_receptor_analysis,CellPhoneDB_ligand_receptor_analysis/CPDB_topInteractions_CtrlCovidCompare.R,Differentially enriched interactions in COVID compared to control,CellPhoneDB results for each individual sample,Ligand-receptor differential enrichment dotplot and boxplot,Fig 4J; Extended Data Figure 13b; Extended Data Table 10
CellPhoneDB_ligand_receptor_analysis,CellPhoneDB_ligand_receptor_analysis/runMultipleSampleCellPhoneDB_bashScript.sh,Bash script to run CellPhoneDB on multiple samples,Normalized count matrix and cell annotation metadata for CellPhoneDB runs,CellPhoneDB outputs of each input sample along with heatmaps and dotplots,"Generated raw data for Fig 4H,I,J; Extended Data Figure 13a,b; and Extended Data Table 10"
CellPhoneDB_ligand_receptor_analysis,CellPhoneDB_ligand_receptor_analysis/runMultipleSampleCellPhoneDB_procedure.txt,The command line/terminal commands to run MultipleSampleCellPhoneDB_bashScript.sh,Needs correct folder path of the bash script,Runs bash script,"Generated raw data for Fig 4H,I,J; Extended Data Figure 13a,b; and Extended Data Table 10"
CellPhoneDB_ligand_receptor_analysis,CellPhoneDB_ligand_receptor_analysis/runSingleSampleCellPhoneDB_procedure.txt,The command line/terminal commands to CellPhoneDB for one sample at a time,Needs correct folder path of the CellPhoneDB input data,Runs CellPhoneDB,"Generated raw data for Fig 4H,I,J; Extended Data Figure 13a,b; and Extended Data Table 10"
Drug_Target_Identification,Drug_Target_Identification/Drug_Target_Identification.R,Drug Target Identification,Protein Activity Matrix                                               Gene expression labels -  vip.clust.fibroblasts.overlay.with.gene_exp.final.csv Viper cluster labels - vip.clust.fibroblasts.csv        Drug matrix - drugs.rds,Drug Target Heatmap,Extended Data Figure 14b
Epithelial_analysis,Epithelial_analysis/AT_UMAP_DM_DATP_signature.R,"Reintegration and diffusion component analysis of AT1 and AT2 cells; UMAPs, dot, feature and violin plots; Generation of DATP signature based on DGE and hypergeometric test; DATP cell state fractions",Integrated Seurat object with cell type assignment,AT1/2 Seurat object with annotated DATPs,"Figure 3D,F,G,H,I,J ;Extended Data Figure 8E,F,G,H,I,J,K,L,M,N,O; Extended Data Table 4; Extended Data Table 8"
Epipthelial_analysis,Epithelial_analysis/DATP_ratio_analysis.R,"Calculate ratio of DATP annotated cells among all AT cells, make boxplot of this ratio in cov and ctr samples, and correlate this ratio with symptom-death interval",AT cell Seurat object with cell type assignment,,Figure 3K
Epithelial_analysis,Epithelial_analysis/Epithelial_UMAP_dotplot.R,UMAPs and dot plots for epithelial cell analysis,Integrated Seurat object with cell type assignment,-,"Figure 3B,C; Extended Data Figure 8A,B,C"
Epithelial_analysis,Epithelial_analysis/Tuft_UMAP_DM.R,"UMAP and diffusion component analysis of airway basal, club, and goblet cells; Identification of tuft cells",Integrated Seurat object with cell type assignment,Epithelial Seurat object with annotated tuft cells; Tuft-like subtype assignment,"Figure 3Q; Extended Data Figure 10A,B,C,D"
Fibroblast and AT analyses,Fibroblast and AT analyses/AT_and_Pathological_FB_scatterplots.R,Correlate AT and Pathological FB cell types frequencies with symptom-death intervals,Integrated Seurat object with cell type assignment,,Extended Data Figure 8R
Fibroblast_analysis,Fibroblast_analysis/Fibroblast_DM.R,Diffusion component analysis of fibroblasts,Integrated Seurat object with cell type assignment,-,
Fibroblast_analysis,Fibroblast_analysis/Fibroblasts_fine_cell_type_annotation.R,Annotation of fine cell types,Integrated Seurat object with cell type assignment,Fine cell type assignment for fibroblast subtypes,"Fig 4E,F; Extended Data Table 9"
Fibroblast_analysis,Fibroblast_analysis/Fibroblasts_manuscript_figures.R,Figures and analysis for fibroblast cells,Fibroblast Seurat object with cell type assignment,"UMAPs, Dotplots, Violin plots, and DEGs","Fig 4E,F; Extended Data Figure 12C"
Fibroblast_analysis,Fibroblast_analysis/fibrosis_score_correlation.R,"Print out scatterplots of 1. Fibrosis score in each patient vs. symptom to death interval, 2. Age vs. symptom to death interval, 3. Fibrosis score vs. age, for covid samples only 4. Fibrosis score vs. age, for control samples only","Integrated Seurat object with cell type assignment, and fibrosis scoring information in Fibrosis_score_sequencing_cohort.txt",,Figure 4C
Global_analysis,Global_analysis/AXL_violin_plots.R,"Print out violin plots of AXL expression across cell_type_main, intermediate, and fine classifications",Integrated Seurat object with cell type assignment,,Extended Data Figure 5C
Global_analysis,Global_analysis/Cell_type_fractions.R,"Cell type fractions in main, intermediate and fine cell type annotations in the full cohort as well as COVID-19 and control subsets; SARS-CoV-2 counts in patient L19cov",Integrated Seurat object with cell type assignment,-,Extended Data Table 2; Extended Data Table 3
Global_analysis,Global_analysis/Create_boxplots.R,"Generate boxplots of cell type frequencies, grouped by either disease status, or sex of samples",Integrated Seurat object with cell type assignment,,"Figure 1E, Extended Data Figure 1A-C, Extended Data Figure 2A-B, Extended Data Figure 12E"
Global_analysis,Global_analysis/Global_cell_type_heatmap.R,"Generate heatmaps of differential gene expression for top 5 marker genes in all cell type clusters, at either cell_type_main or intermediate level",List of top 5 marker genes for cell type main and intermediate clusters,,
Global_analysis,Global_analysis/Global_UMAPs.R,"Create UMAPs of cell type classification and COVID-19 across across samples, as well as UMAPs highlighting cells from individual patients",Integrated Seurat object with cell type assignment,,Figure 1C-D
Global_analysis,Global_analysis/Harmony.R,Global UMAPs based on Harmony,Integrated Seurat object with cell type assignment; Harmony coordinates,-,"Extended Data Figure 1A,B"
Global_analysis,Global_analysis/misc_signature_differential_expression.R,Calculate differential expression of three important gene signatures across all intermediate cell types,,,"Extended Data Figure 9A, Extended Data Table 4"
Global_analysis,Global_analysis/Sex_differences.R,UMAP and dot plots to analyze sex differences in global object,Integrated Seurat object with cell type assignment,-,"Extended Data Figure 3C,D,E,F"
Initial_processing,Initial_processing/01_Individual_seurat_analysis.R,Seurat analysis for CellBender output with sample name and expected doublet rate provided in arguments,CellBender output (filtered.h5),Individual Seurat objects,-
Initial_processing,Initial_processing/02_Integration.R,Seurat integration for all lung samples,Individual Seurat objects,Integrated Seurat object,-
Initial_processing,Initial_processing/03_Main_cell_type_annotation.R,Annotation of main cell types in lung samples,Integrated Seurat object,Integrated Seurat object with main cell type assignment,-
Initial_processing,Initial_processing/04_Fine_cell_type_annotation_bcells.R,Annotation of fine cell types,Integrated Seurat object,Fine cell type assignment for subset,-
Initial_processing,Initial_processing/04_Fine_cell_type_annotation_endothelial.R,Annotation of fine cell types,Integrated Seurat object,Fine cell type assignment for subset,-
Initial_processing,Initial_processing/04_Fine_cell_type_annotation_epithelial.R,Annotation of fine cell types,Integrated Seurat object,Fine cell type assignment for subset,-
Initial_processing,Initial_processing/04_Fine_cell_type_annotation_fibroblasts.R,Annotation of fine cell types,Integrated Seurat object,Fine cell type assignment for subset,-
Initial_processing,Initial_processing/04_Fine_cell_type_annotation_myeloid.R,Annotation of fine cell types,Integrated Seurat object,Fine cell type assignment for subset,-
Initial_processing,Initial_processing/04_Fine_cell_type_annotation_tcells.R,Annotation of fine cell types,Integrated Seurat object,Fine cell type assignment for subset,-
Initial_processing,Initial_processing/05_Merge_fine_cell_type_annotation.R,Merging annotation of fine cell types,"Integrated Seurat object, fine cell type assignments from subsets",Integrated Seurat object with main and fine cell type assignments,-
Initial_processing,Initial_processing/06_Annotate_cell_type_intermediate.R,Annotation of intermediate cell types,Integrated Seurat object with main and fine cell type assignment,"Integrated Seurat object with main, fine, and intermediate cell type assignments",-
Master_Regulator_Analysis,Master_Regulator_Analysis/Master_Regulator_Analysis_COVID.R Master_Regulator_Analysis/Functions_MasterRegulators.R,Master Regulator Analysis of COVID data,Integrated Seurat object with cell type assignment Gene Expression labels - vip.clust.fibroblasts.overlay.with.gene_exp.csv Pathological vs Non-pathological fibroblasts - vip.clust.fibroblasts.overlay.with.gene_exp.int.csv,Master Regulator Heatmap,"Figure 4K, Extended Data Figure 14a"
misc,misc/ReadCB_h5.R,Function to read h5 files from CellBender output into Seurat,-,-,-
misc,misc/scrublet_code.py,Run Scrublet,-,-,-
Myeloid_analysis,Myeloid_analysis/myeloid_frequency_boxplot.R,"Print out boxplots of cell type frequency within myeloid compartment, for covid and ctr samples",Myeloid Seurat object with cell type assignment,,Extended Data Figure 4F
Myeloid_analysis,Myeloid_analysis/Myeloid_UMAP_DM_AM_annotation.R,UMAP and diffusion map analysis of myeloid cells; Annotation of alveolar cells,Integrated Seurat object with cell type assignment,Myeloid Seurat object with annotated AMs; AM subtype assignment,"Figure 2B,C,D; Extended Data Figure 4B,C,D,E,F"
Myeloid and AT analyses,Myeloid_and_AT_heatmaps.R,"Generate heatmaps of differential gene expression for AT cells, fibroblasts, or myeloid cells, comparing either different groups of cells, or comparing COVID-19 samples vs. Control samples within the same cell type",Integrated Seurat object with cell type assignment,,"Figure 3E, Extended Data Figure 4G, Extended Data Figure 5A-B, Extended Data Tables 5, 7, and 9"
T_cell_analysis,T_cell_analysis/T_cell_UMAP.R,UMAP analysis of T cells; Dot and feature plots,Integrated Seurat object with cell type assignment,-,"Figure 2J,K,L; Extended Data Figure 7A"
T_cell_analysis,T_cell_analysis/Tcell_analysis.py,Harmony batch correction and scoring of T cell signatures,Integrated AnnData object with cell type assignment,"Harmony-correced PCA matrix and UMAP embedding, scores and figures of T cell programs for CD8 and CD4 T cells","Extended Data Figure 1, Extended Data Figure 7D-G"
Vectra_image_analysis,Vectra_image_analysis/classifiers/classes.json,Individual classes for annotation in QuPath,Load as class annotation in QuPath,,"Processing for Figure 2 m-n, Extended data 4a and 7 b,c,h,i "
Vectra_image_analysis,Vectra_image_analysis/classifiers/object_classifiers/*.json,Individual classifiers for QuPath,Load as classifier in QuPath,Classification for all cells,"Extended data 4a and 7 b,c,h,i "
Vectra_image_analysis,Vectra_image_analysis/Load_and_segmentation.groovy,QuPath executable script to load and segment vectra images ,Execute in QuPath as script for all images,All images loaded and segmented,"Processing for Figure 2 m-n, Extended data 4a and 7 b,c,h,i "
Vectra_image_analysis,Vectra_image_analysis/project.qpproj,QuPath project file,Load as project in QuPath,All workflows saved in one project file,"Project to analyze and visualize images for Figure 2 m-n, Extended data 4a and 7 b,c,h,i "